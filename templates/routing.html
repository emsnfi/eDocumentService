{% extends "base.html" %}
{% block content %}
{% csrf_token %} 

<div class="container">
	<div id="app">
		<eds_nav></eds_nav>
		<div role="main" id="id_main">
			<routerview></routerview>
		</div>
		<eds_footer></eds_footer>
	</div>
</div>

<script>
	Vue.use(VueMeta);
	Vue.use(Vuex);
	//Vue.options.delimiters = ['{|{', '}|}'];

	let mapState = Vuex.mapState;

	var title = '';
	window.addEventListener('focus', () => {
		setTimeout(() => document.title = title, 1000);
	});

//$(()=>{
	appVue = new Vue({
		el: '#app',
		store,
		components: {
			eds_nav: components['eds_nav'],
			routerview: pages['{{ app }}/{{ page }}'],
			eds_footer: components['eds_footer'],
		},
		data: {
			mode: 'all',
		},
		computed: {
			...mapState({
				user: 'user',
			}),
		},
		metaInfo: {
			titleTemplate: (subTitle) => {
				if(subTitle){
					title = `${subTitle} | 雲端千眼平台`;
					//setInterval(() => document.title = title, 1000);
					setTimeout(() => document.title = title, 1000);
					return title;
				}
				else {
					title = `雲端千眼平台`;
					return title;
				}
				//appVue.$forceUpdate();
			},
		},
		created(){
			{% if user.is_authenticated %}
			this.$store.dispatch('getUser',
			{
				id: {{ request.user.id }},
			});
			{% endif %}

			mode = localStorage.getItem('nav_mode');
			if(!mode) {
				this.mode = 'all'
			}
			else {
				this.mode = mode
			}

		},
		mounted(){
		},
	});
//})
</script>

{% endblock %}