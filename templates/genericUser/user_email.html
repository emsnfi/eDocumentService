{% extends "base_nav.html" %}
{% load staticfiles %}
{% block title %}
訊息傳送
{% endblock %}
{% block content %}
{% include 'comp/drf.vue' %}
{% csrf_token %}

<div id="user_email">
	<h2>訊息傳送</h2>
				<drf-model
						:keys="'category'"
						:model_info="model_info.category"
					mode="write"
					v-model="category"
				></drf-model>
				<drf-model
						:keys="'subject'"
						:model_info="model_info.subject"
					mode="write"
					v-model="subject"
				></drf-model>
				<drf-model
						:keys="'body'"
						:model_info="model_info.body"
					mode="write"
					v-model="body"
				></drf-model>
				<button class="btn btn-default" @click="send_email()">傳送</button>
</div>

<script>
	Vue.options.delimiters = ['{|{', '}|}'];

	new Vue({
		el: '#user_email',
		data: {
			category: 'editor',
			subject: '',
			body: '',
			model_info: {
				'category': {
					'label': '類型',
					'type': 'radio',
					'remark': '請選擇類型',
					'choices' : [
						{
							'value': 'editor',
							'display_name': '志工',
						},
						{
							'value': 'guest',
							'display_name': '視障者',
						},
					],
				},
				'subject': {
					'label': '主指',
					'type': 'string',
					'remark': '請填寫主指',
				},
				'body': {
					'label': '內容',
					'type': 'string',
					'remark': '請填寫內容',
				},
			},
		},
		created: function () {
			this.client = new $.RestClient('/genericUser/api/');
			this.client.add('users');
		},
		methods: {
			send_email: function () {
				let self = this

				post_data = {
					'category': self.category,
					'subject': self.subject,
					'body': self.body,
				}
				rest_aj_send('post', '/genericUser/api/users/action/email/', post_data)
				.done(function(data) {
					alertmessage('success', '成功傳送訊息')
				})
				.fail(function(xhr, result, statusText){
					alertmessage('error', xhr)
					console.log(xhr)
				})
			},
		},
	})
</script>

{% endblock %}