{% extends "base_nav.html" %}
{% block title %}
調出視窗測試
{% endblock %}
{% block content %}

{% csrf_token %}
{% include 'comp/modal.vue' %}
{% include 'dev/form.vue' %}

<div id="app">
	<button type="button" class="btn btn-primary" data-toggle="modal" :data-target="'#'+name">Modal</button>
	<modal :id_modal="name">
		<template slot="header">
			<h4 class="modal-title" id="myModalLabel">{|{ title }|}</h4>
		</template>
		<template slot="body">
			<form-drf
				:fields="fields"
				:url="url"
				:bus="bus"
				@get="renew_datas($event)"
			></form-drf>
		</template>

		<template slot="footer">
			<button class="btn btn-default" data-dismiss="modal">關閉</button>
			<button class="btn btn-primary" @click="get">儲存</button>
		</template>

	</modal>
</div>

<script>
	Vue.options.delimiters = ['{|{', '}|}'];
	let vo_book;

	$(function(){
		let user_id = $('div[user_id]').attr('user_id');
		let opt = {
			el: '#app',
			data: {
				name: "usermodel",
				title: "更改使用者資訊",
				user_id: user_id,
				bus: new Vue(),
				fields: [
					{
						keys: 'email',
						value: 'tseng@yahoo',
						'model_info': {
							'label': '信箱',
							'type': 'text',
							'remark': '請填寫電子信箱',
						},
					},
					{
						keys: 'first_name',
						value: '',
						'model_info': {
							'label': '姓氏',
							'type': 'text',
							'remark': '請填寫中文姓氏',
						},
					},
					{
						keys: 'last_name',
						value: '',
						'model_info': {
							'label': '名字',
							'type': 'text',
							'remark': '請填寫中文名字',
						},
					},
					{
						keys: 'phone',
						value: '',
						'model_info': {
							'label': '聯絡電話',
							'type': 'text',
							'remark': '請填寫手機',
						},
					},
					{
						keys: 'birthday',
						value: '',
						'model_info': {
							'label': '生日',
							'type': 'date',
							'remark': '請填寫生日，範例日期格式：1989-02-19',
						},
					},
					{
						keys: 'education',
						value: '',
						'model_info': {
							'label': '教育程度',
							'type': 'select',
							'remark': '請選擇教育程度',
							'choices' : [
								{
									'value': '國小',
									'display_name': '國小',
								},
								{
									'value': '國中',
									'display_name': '國中',
								},
								{
									'value': '高中',
									'display_name': '高中',
								},
								{
									'value': '學士',
									'display_name': '學士',
								},
								{
									'value': '碩士',
									'display_name': '碩士',
								},
							],
						},
					},
					{
						keys: 'is_book',
						value: '',
						'model_info': {
							'label': '訂閱訊息',
							'type': 'checkbox',
							'remark': '訂閱訊息',
						},
					},
					{
						keys: 'org',
						value: '',
						'model_info': {
							'label': '隸屬單位',
							'type': 'select',
							'remark': '請選擇所屬單位',
							'choices': [],
						},
					},
				],
			},
			computed: {
				url: function(){
					return '/genericUser/api/users/' + this.user_id + '/';
				},
			},
			created() {
				this.client = new $.RestClient('/genericUser/api/');
				this.client.add('organizations');

				let self = this;

				self.client.organizations.read()
				.done(function(data) {
					_.each(data, function(v){
						self.fields[7].model_info.choices.push({
							'value': v.id,
							'display_name': v.name,
						})
					});
				})
			},
			methods: {
				get: function(){
					this.bus.$emit('get');
				},
				renew_datas: function(new_datas){
					_.each(new_datas, function(v, k){

					})
				},
			} 
		};		

		vo_book = new Vue(opt);
	});

</script>
{% endblock %}