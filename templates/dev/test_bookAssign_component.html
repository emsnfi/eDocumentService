<script type="text/x-template" id="modal-template">
    <div class="modal fade" :id="modalName" tabindex="-1" role="dialog" :aria-labelledby="modalName+'Label'" aria-hidden="true">
      	<div class="modal-dialog modal-md" role="document">
        	<div class="modal-content alert-info" style="background-color: #f5f5f5;">
          		<div class="modal-header">
              
	            	<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>

	            	<slot name="header">
	                	<h4 class="modal-title">Modal title</h4>
	            	</slot>
          		</div>
				<div class="modal-body">
					<slot name="body">
						default body
					</slot>
				</div>
          		<div class="modal-footer">
            		<slot name="footer">
              			<button type="button" class="btn btn-default" data-dismiss="modal">關閉</button>
              			<button type="button" class="btn btn-primary">儲存</button>
            		</slot>
          		</div>
        	</div>
      	</div>
    </div>  
</script>

<script type="text/x-template" id="assign-template">

	<div class="form-horizontal">
		<div class="form-group">
			<label class="control-label col-sm-4">搜尋</label>
			<div class="col-sm-4">
				<input type="text" class="form-control" v-model="filter_word">
			</div>
			<div class="col-sm-2">
				<button class="btn btn-primary" @click="filter_user">確認</button>
			</div>
		</div>

		<div class="form-group">
			<label class="control-label col-sm-4">選擇使用者</label>
			<div class="col-sm-4">
				<select class="form-control" v-model="assign_user">
			  		<option value="">---</option>
					<template v-if="!iser(users)" v-for="(user, index) in users">
				    	<option
				    	:value="user.id">
				    		{|{ user.username }|}
				    	</option>
					</template>
				</select>
			</div>
		</div>

		<div class="form-group">
			<label class="control-label col-sm-4">預定完成時間</label>
			<div class="col-sm-4">
				<el-date-picker 
			    v-model="deadline"
			    type="date"
			    value-format="yyyy-MM-dd"   
			    placeholder="yyyy-MM-dd"
			    ></el-date-picker>
			</div>
		</div>
	</div>
</script>

<script>

	Vue.options.delimiters = ['{|{', '}|}'];

	Vue.component('modal-component', {
	    template: '#modal-template',
	    props: {
	        modalName: String,  // define type
	    },
	});

	Vue.component('assign-component', {
	    template: '#assign-template',
	    props: ['isbn', 'bus'],


	    data: function(){
	    	return {
	    		// assign data
	    		isbn: '',
	    		assign_user: '',
	    		deadline: '',    

	    		users: [],		 // present users
	    		orig_users: [],  // save api source users
	    		filter_word: '',
	    	}
	    },

	    watch: {
	    	isbn: function(value){
	    		this.isbn = value;
	    	}
	    },

	    methods: {
	    	save_assign: function(){
	    		// post to assign
	    		console.log(this.assign_user);
	    		console.log(this.deadline);
	    	},
	    	filter_user: function(){
	    		let vo = this;
	    		vo.filter_word = vo.filter_word.trim();
	    		let filtered_users = vo.orig_users.filter(function(item, index, array){
	    			return item['username'].indexOf(vo.filter_word) !== -1 ;
	    		})
	    		vo.users = filtered_users;
	    	}
	    },

	    created () {
	    	let vo = this;
	    	rest_aj_send('get', '/genericUser/api/users/', {})
    		.done(function(data) {
    			console.log(data.data);
    			_.each(data.data, function(v, k){
    				vo.users.push({
    					id: v['id'],
    					username: v['username']
    				})
    				
    			})
			})

			vo.orig_users = vo.users;

			let d = new Date();
			// deadline default 今天+3天
    		vo.deadline = d.getFullYear()+'-'+(d.getMonth() + 1)+'-'+(d.getDate()+3); 
	    },
	    mounted () {
	    	this.bus.$on('submit', this.save_assign)
	    }
	})

</script>