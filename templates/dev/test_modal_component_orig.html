{% extends "base_nav.html" %}
{% block title %}
調出視窗測試
{% endblock %}
{% block content %}

{% csrf_token %}

<div id="app">
	<button type="button" class="btn btn-primary" data-toggle="modal" :data-target="'#'+name"  @click="refresh_info">Modal</button>
	<modal-component :modal-name="name">

		<template slot="header">
			<h4 class="modal-title" id="myModalLabel">{|{ title }|}</h4>
		</template>

		<template slot="body">
			<form-component
			:model_infos="model_infos"
			:url="url"
			:bus="bus"
			></form-component>
		</template>

		<template slot="footer">
			<button type="button" class="btn btn-default" data-dismiss="modal">關閉</button>
			<button type="button" class="btn btn-primary" @click="update_info">儲存</button>
		</template>

	</modal-component>	 

</div>

<script>
	Vue.options.delimiters = ['{|{', '}|}'];
	let vo_book;

	$(function(){
		let user_id = $('div[user_id]').attr('user_id');
		let opt = {
			el: '#app',
			data: {
				name: "usermodel",
				title: "更改使用者資訊",
				user_id: user_id,
				bus: new Vue(),
				model_infos : {
							'email': {
									'label': '信箱',
									'type': 'text',
									'remark': '請填寫電子信箱',
							},
							'first_name': {
									'label': '性氏',
									'type': 'text',
									'remark': '請填寫中文姓氏',
							},
							'last_name': {
									'label': '名字',
									'type': 'text',
									'remark': '請填寫中文名字',
							},
							'phone': {
									'label': '聯絡電話',
									'type': 'text',
									'remark': '請填寫手機',
							},
							'birthday': {
									'label': '生日',
									'type': 'date',
									'remark': '請填寫生日，範例日期格式：1989-02-19',
							},
							'education': {
									'label': '教育程度',
									'type': 'select',
									'remark': '請選擇教育程度',
									'choices' : {
											'' :'---------',
											'國小': '國小',
											'國中': '國中',
											'高中': '高中',
											'學士': '學士',
											'碩士': '碩士',
									},
							},
							'is_book': {
									'label': '訂閱訊息',
									'type': 'checkbox',
									'remark': '訂閱訊息',
							},
							'org': {
									'label': '隸屬單位',
									'type': 'select',
									'remark': '請選擇所屬單位',
									'choices' : {
										'' :'其它',
									},
							},
				},
			},
			computed: {
				url: function(){
					return '/genericUser/api/users/' + this.user_id + '/';
				},
			},
			created() {
				let vo = this;
				let org_url = '/genericUser/api/organizations/';
				rest_aj_send('get', org_url, {})
				.done(function(data) {
						_.each(data.data, function(v, k){
							vo.model_infos.org.choices[v.id] = v.name;
						});
				})
			},
			methods: {
				refresh_info: function(){
					this.bus.$emit('refresh');
				},
				update_info: function(){
					this.bus.$emit('update');
				},
			} 
		};		

		vo_book = new Vue(opt);
	});

</script>
{% endblock %}