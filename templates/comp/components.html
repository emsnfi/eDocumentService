<script type="text/javascript">

	base_table = {
		props: {
			datas: Array,  // define type
			header: Object,
			tdwidths: {
				default: [],
			},
		},
		data: function () {
			return {
				numPerPage: 10,
				pagenow: 1,
				showPrevMore: false,
				showNextMore: false,
				pagerCount: 7,
			}
		},
		computed: {
			numpage: function () {
				return Math.ceil(this.datas.length / this.numPerPage);
			},
			numrow: function () {
				return this.datas.length
			},
			start: function () {
				return this.numPerPage *(this.pagenow -1)
			},
			end: function () {
				return Math.min(this.numPerPage *(this.pagenow), this.numrow)
			},
			pagers() {
				const pagerCount = this.pagerCount;
				const halfPagerCount = (this.pagerCount - 1) / 2;
				const currentPage = Number(this.pagenow);
				const pageCount = Number(this.numpage);
				let showPrevMore = false;
				let showNextMore = false;
				if (pageCount > pagerCount) {
					if (currentPage > pagerCount - halfPagerCount) {
					  showPrevMore = true;
					}
					if (currentPage < pageCount - halfPagerCount) {
					  showNextMore = true;
					}
				}
				const array = [];
				if (showPrevMore && !showNextMore) {
					const startPage = pageCount - (pagerCount - 2);
					for (let i = startPage; i < pageCount; i++) {
					  array.push(i);
					}
				} 
				else if (!showPrevMore && showNextMore) {
					for (let i = 2; i < pagerCount; i++) {
					  array.push(i);
					}
				} 
				else if (showPrevMore && showNextMore) {
					const offset = Math.floor(pagerCount / 2) - 1;
					for (let i = currentPage - offset; i <= currentPage + offset; i++) {
					  array.push(i);
					}
				} 
				else {
					for (let i = 2; i < pageCount; i++) {
					  array.push(i);
					}
				}

				this.showPrevMore = showPrevMore;
				this.showNextMore = showNextMore;
				return array;
			},
		},
		watch: {
			datas: function (val) {
				this.pagenow = 1
			},
		},
		methods: {
			pagin_change(oper) {
				const pagerCountOffset = this.pagerCount - 2;

				if (String(oper) === '+1') {
					this.pagenow += 1;
				} 
				else if (String(oper) === '-1') {
					this.pagenow -= 1;
				} 
				else if (String(oper) === 'quickprev') {
					this.pagenow = this.pagenow - pagerCountOffset;
				} 
				else if (String(oper) === 'quicknext') {
					this.pagenow = this.pagenow + pagerCountOffset;
				} 
				else {
					this.pagenow = parseInt(oper, 10);
				}

				this.pagenow = Math.max(this.pagenow, 1);
				this.pagenow = Math.min(this.pagenow, this.numpage);
			},
			tdStyles (index) {
				if (
					this.tdwidths.reduce((prev, next) => parseInt(prev) + parseInt(next), 0) !== 100 
				) {
					return null;
				}
				return { width: this.tdwidths[index] + '%' };
			},
		},
	}

	function set_components(components) {
		let timestamp = '?' + Date.now();
		let components_array = [
			'book_download',
			'book_manager_org',
			'book_origin_download',
			'book_review_list_org',
			'book_upload',
			'bookinfo_repository',
			'bookinfo_search',
			'book_repository_school_filter',
			'category_manager_org',
			'disabilitycard',
			'disabilitycard_manager_org',
			'drf',
			'ebook_assign_component',
			'ebook_review_list_org',
			'eds_nav',
			'eds_nav_all',
			'eds_nav_self',
			'file_manager',
			'file_upload',
			'eds_footer',
			'form',
			'home_all',
			'home_self',
			'list_vue_component',
			'modal',
			'qanda',
			'service_org',
			'serviceinfo_list_check_org',
			'serviceinfo_record',
			'set_usermodel',
			'set_password',
			'set_priority',
			'statistics',
			'tab',
			'panel_group',
			'table-div',
			'table-div-filter',
			'table-div-order',
			'table-div-row',
			'table-word-break',
			'user_manager_org',
			'user_permission',
			'viewer',
			'scan_book_editor',
		]
		_.each(components_array, function(v){
			url = '/static/ebookSystem/js/vue-component/' +v +'.vue' +timestamp
			//url = '/static/ebookSystem/js/vue-component/' +v +'.vue'
			components[v] = httpVueLoader(url)
		})
		return components
	}

	var components = set_components({})

	function set_pages(pages) {
		let timestamp = '?' + Date.now();
		let pages_array = [
			'genericUser/announcement',
			'genericUser/announcement_create',
			'genericUser/announcement_list',
			'genericUser/announcement_school_list',
			'genericUser/bannercontent_create',
			'genericUser/disabilitycard_manager',
			'genericUser/disabilitycard_manager_self',
			'genericUser/editor_zone_school',
			'genericUser/guest_zone_school',
			'genericUser/login',
			'genericUser/manager_school',
			'genericUser/qanda_all',
			'genericUser/qanda_tutorial',
			'genericUser/register',
			'genericUser/retrieve',
			'genericUser/serviceinfo_list_check',
			'genericUser/serviceinfo_list_check_self',
			'genericUser/serviceinfo_record',
			'genericUser/user_email',
			'genericUser/user_manager',
			'genericUser/user_manager_self',
			'genericUser/user_person',
			
			'ebookSystem/book_create',
			'ebookSystem/book_detail',
			'ebookSystem/book_manager',
			'ebookSystem/book_manager_self',
			'ebookSystem/book_person',
			'ebookSystem/book_repository',
			'ebookSystem/book_repository_school',
			'ebookSystem/book_review',
			'ebookSystem/book_review_list',
			'ebookSystem/book_review_list_self',
			'ebookSystem/book_shelf',
			'ebookSystem/book_upload',
			'ebookSystem/bookorder_list',
			'ebookSystem/category_manager_self',
			'ebookSystem/ebook_manager',
			'ebookSystem/ebook_review',
			'ebookSystem/ebook_review_list',
			'ebookSystem/ebook_review_list_self',
			'ebookSystem/service',
			'ebookSystem/service_self',
			'ebookSystem/edit',
			'genericUser/statistics',
			'mysite/ddm',
			'mysite/home',
			'mysite/generic',
			'mysite/school',
			'mysite/sitemap',
			'mysite/statistics',
			'mysite/statistics_org',
			'school/book_manager',
			'school/ebook_review_list',
			'about/about',
			'about/about_school',
			'about/contact',
			'about/contact_school',
			'about/development',
			'about/donation_school',
			'about/recruit',
			'about/recruit_school',
			'about/origin',
			'about/privacy_and_security',
			'about/terms_of_service',
			'about/user_guide',

			'about/copyright',
			'about/proofread_rules',
			'about/service_hours_description',
		]
		_.each(pages_array, function(v){
			url = '/static/ebookSystem/js/vue-component/page/' +v +'.vue' +timestamp
			//url = '/static/ebookSystem/js/vue-component/' +v +'.vue'
			pages[v] = httpVueLoader(url)
		})
		return pages
	}

	var pages = set_pages({})

</script>